package br.net.walltec.api.importacao.estrategia;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

import br.net.walltec.api.dto.RegistroExtratoDto;
import br.net.walltec.api.excecoes.WalltecException;

public class ImportadorBB implements ImportadorArquivo {
    @Override
    public List<RegistroExtratoDto> importar(String nomeArquivo, byte[] dadosArquivo) throws WalltecException {
        List<RegistroExtratoDto> dtos = new ArrayList<RegistroExtratoDto>();
        String[] linhas = new String(dadosArquivo).split("\n");
   	    /*dtos = linhas.stream()
   	          .filter(linha -> {
   	        	return !linha.contains("S A L D O");
   	          })
   	          .map(linha -> {
  				if (linha.substring(0,16).trim().isEmpty()) {
					RegistroExtratoDto dto = dtos.get(dtos.size()-1);
					dto.setHistorico( dto.getHistorico() + " " +linha.trim());
				} else {
					RegistroExtratoDto dto = new RegistroExtratoDto();
					dto.setDataLancamento(linha.substring(0,8));
					dto.setHistorico(linha.substring(17, 43).trim());
					dto.setDocumento(linha.substring(43, 66).trim());
					dto.setValor( linha.substring(67,78).trim() );
					dtos.add(dto);
				}
   	          })
   	          .collect(Collectors.toList());
   	      */    
         try {
    		
    		for(int i = 9; i < linhas.length; i++) {
    			if (linhas[i].contains("S A L D O")) {
    				break;
    			} else {
    				if (linhas[i].substring(0,16).trim().isEmpty()) {
    					RegistroExtratoDto dto = dtos.get(dtos.size()-1);
    					dto.setHistorico( dto.getHistorico() + " " +linhas[i].trim());
    				} else {
    					RegistroExtratoDto dto = new RegistroExtratoDto();
    					dto.setDataLancamento(linhas[i].substring(0,8));
    					dto.setHistorico(linhas[i].substring(17, 43).trim());
    					dto.setDocumento(linhas[i].substring(43, 66).trim());
    					dto.setValor( linhas[i].substring(67,78).trim() );
    					dtos.add(dto);
    				}
    			}
            }
        } catch (Exception e) {
            throw new WalltecException(e.getMessage());
        }

        return dtos;
    }
    
}

import { Injectable } from "@angular/core";
import { FiltraParcelasDto } from "../dominio/dto/filtra-parcelas-dto";
import { Observable } from "rxjs/Observable";
import { LancamentoVO } from "../dominio/vo/lancamento-vo";
import { AbstractServicos } from "../servicos/abstract.servicos";
import { HttpInterceptor } from "../servicos/http-interceptor";
import { UtilObjeto } from "../utilitarios/util-objeto";
import { UtilizacaoParcelasDto } from "../dominio/dto/utilizacao-parcelas-dto";
import { Constantes } from "../utilitarios/constantes";
import { UtilizacaoLancamentoVO } from "../dominio/vo/utilizacao-lancamento-vo";
import { BaixaLancamentoDTO } from "../dominio/dto/baixa-lancamento-dto";

@Injectable()
export class LancamentoService extends AbstractServicos<LancamentoVO>  {

    protected uri: string = '/lancamentos';
    
    constructor(protected http: HttpInterceptor) { 
        super();
    }

    public transformar(element: any): LancamentoVO {
        return UtilObjeto.transformar(element, new LancamentoVO());
    }
    

    public filtrar(dto: FiltraParcelasDto): Observable<LancamentoVO[]> {
        return this.pesquisar(this.uri+"/buscarLancamentos", JSON.stringify(dto))
            .map(dados => dados);
    }

    public utilizar(dto: UtilizacaoParcelasDto): Observable<any> {
        return this.http.post(this.uri + '/utilizar', JSON.stringify(dto));

    }

    public baixar(dto: BaixaLancamentoDTO): Observable<any> {
        return this.http.post(this.uri + '/baixar', JSON.stringify(dto));

    }

    public listarUsos(idLancamento: number): Observable<UtilizacaoLancamentoVO[]> {
        let lista : UtilizacaoLancamentoVO[] = [];
        return this.pesquisarGet(this.uri + '/listarHistoricoUso?idLancamento='+idLancamento)
                .map(dados => {
                    dados.forEach(element => {
                        let vo: UtilizacaoLancamentoVO = new UtilizacaoLancamentoVO();
                        vo.transformar(element)
                        lista.push(vo);                        
                    });
                    return lista;
                });
                
    }


}